resource "aws_iam_group" "ec2admins" {
  name = "ec2admins"
}

resource "aws_iam_group_policy_attachment" "attach-ec2admins-ec2fullaccess-group-policy" {
  group      = aws_iam_group.ec2admins.name
  count      = length(var.ec2admins-arns)
  policy_arn = var.ec2admins-arns[count.index]
}

#resource "aws_iam_group_policy_attachment" "attach-ec2admins-changepass-group-policy" {
#  group      = aws_iam_group.ec2admins.name
#  policy_arn = data.aws_iam_policy.IAMUserChangePassword.arn
#}

resource "aws_iam_group_membership" "ec2fullaccess-group-membership" {
  name = "ec2fullaccess-group-membership"

  users = [
    aws_iam_user.nonoytest1.name
  ]

  group = aws_iam_group.ec2admins.name
}

data "aws_iam_policy" "AmazonEC2FullAccess" {
  arn = "arn:aws:iam::aws:policy/AmazonEC2FullAccess"
}

data "aws_iam_policy" "IAMUserChangePassword" {
  arn = "arn:aws:iam::aws:policy/IAMUserChangePassword"
}